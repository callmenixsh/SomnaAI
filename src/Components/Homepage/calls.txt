import React, { useEffect, useRef } from 'react';
import Chart from 'chart.js/auto';

const Patterns = () => {
  const chartRef = useRef(null);

  useEffect(() => {
    fetch('/api/emotion-analysis')
      .then(res => res.json())
      .then(data => {
        if (chartRef.current) {
          new Chart(chartRef.current, {
            type: 'line',
            data: {
              labels: data.labels, // e.g., ['Week 1', 'Week 2', 'Week 3']
              datasets: [
                {
                  label: 'Positivity',
                  data: data.values, // e.g., [3, 5, 7]
                  borderColor: '#6366f1',
                  backgroundColor: 'rgba(99, 102, 241, 0.2)',
                  fill: true,
                  tension: 0.3,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false },
              },
              scales: {
                y: { beginAtZero: true },
              },
            },
          });
        }
      })
      .catch((err) => console.error('Failed to load chart data:', err));
  }, []);

  return (
    <section className="mb-16">
      <div className="max-w-4xl mx-auto text-center mb-12">
        <h2 className="text-3xl font-bold mb-4">Dream Patterns & Insights</h2>
        <p className="text-lg text-gray-300">
          Discover recurring themes and emotional patterns in your subconscious.
        </p>
      </div>

      <div className="bg-[#1f1b36] rounded-xl p-6">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          {/* Common Themes */}
          <div>
            <h3 className="text-xl font-semibold mb-4">Common Themes</h3>
            <div className="space-y-4">
              {/* Theme 1 */}
              <div>
                <p className="font-medium mb-1">Flying Dreams</p>
                <div className="w-full bg-[#2a2438] rounded-full h-2">
                  <div
                    className="bg-indigo-500 h-2 rounded-full"
                    style={{ width: '75%' }}
                  ></div>
                </div>
                <p className="text-sm text-gray-300 mt-1">
                  Present in 12 of your last 30 dreams
                </p>
              </div>

              {/* Theme 2 */}
              <div>
                <p className="font-medium mb-1">Meeting Strangers</p>
                <div className="w-full bg-[#2a2438] rounded-full h-2">
                  <div
                    className="bg-purple-500 h-2 rounded-full"
                    style={{ width: '60%' }}
                  ></div>
                </div>
                <p className="text-sm text-gray-300 mt-1">
                  Present in 8 of your last 30 dreams
                </p>
              </div>

              {/* Theme 3 */}
              <div>
                <p className="font-medium mb-1">Lost Items</p>
                <div className="w-full bg-[#2a2438] rounded-full h-2">
                  <div
                    className="bg-pink-500 h-2 rounded-full"
                    style={{ width: '40%' }}
                  ></div>
                </div>
                <p className="text-sm text-gray-300 mt-1">
                  Present in 5 of your last 30 dreams
                </p>
              </div>
            </div>
          </div>

          {/* Emotional Trends */}
          <div>
            <h3 className="text-xl font-semibold mb-4">Emotional Trends</h3>
            <div className="relative h-64">
              <canvas ref={chartRef}></canvas>
            </div>
            <p className="text-sm text-gray-300 mt-2">
              Your dreams have been increasingly positive over the last month.
            </p>
          </div>
        </div>
      </div>
    </section>
  );
};

export default Patterns;



{
  "labels": ["Week 1", "Week 2", "Week 3", "Week 4"],
  "values": [3.2, 4.1, 5.8, 6.7]
}
